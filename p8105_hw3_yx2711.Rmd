---
title: "p8105_hw3_yx2711"
author: "Yingchen Xu"
date: "2022-10-15"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(readxl)
library(ggridges)
library(patchwork)
library(p8105.datasets)

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```


#Problem 1

Load dataset `instacart`
```{r}
data("instacart")

instacart = instacart %>%
  as_tibble(instacart) %>% 
  janitor::clean_names()
```

There are `r nrow(instacart)` rows and `r ncol(instacart)` columns in the `instacart` dataset, with each row representing one product of the order. Key variables include order details (order number, order time, etc), user id and product detail (product id, product name, products' departments). In total, there are `r instacart %>% select(product_id) %>% distinct %>% count` products found in `r instacart %>% select(user_id, order_id) %>% distinct %>% count` orders from `r instacart %>% select(user_id) %>% distinct %>% count` distinct users.

Count number of aisles and identify which aisles are the most items ordered from.
```{r}
instacart %>% 
  select(aisle) %>% 
  distinct %>% 
  count()

instacart %>% 
  group_by(aisle) %>% 
  summarize(obs = n()) %>% 
  arrange(desc(obs))
```

There are `r instacart %>% select(aisle) %>% distinct %>% count()` aisles and fresh vegetables and fresh fruits have the most orders. 

Make a plot that shows the number of items ordered in each aisle, arrange and organize.
```{r}
instacart %>% 
  count(aisle) %>% 
  filter(n > 10000) %>% 
  mutate(aisle = fct_reorder(aisle, n)) %>% 
  ggplot(aes(x = aisle, y = n)) + 
  geom_point() + 
  labs(title = "Number of items ordered in each aisle") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1))
```

Make a table showing the three most popular items in each of the aisles "baking ingredients", "dog food care', and "packaged vegetables fruit."
```{r}
instacart %>% 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>%
  group_by(aisle) %>% 
  count(product_name) %>% 
  mutate(rank = min_rank(desc(n))) %>% 
  filter(rank < 4) %>% 
  arrange(desc(n)) %>%
  knitr::kable()
```

Make a table showing the mean hour the day at which Pink Lady Apples and Coffee Ice Cream are ordered on each day of the week
```{r}
instacart %>%
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>%
  group_by(product_name, order_dow) %>%
  summarize(mean_hour = mean(order_hour_of_day)) %>%
  spread(key = order_dow, value = mean_hour) %>%
  knitr::kable(digits = 2)
```


#Problem 2

Read file and clean names.
Use `mutate()` to add a type variable to indicate that whether the day is a weekend or a weekday.
Use `Pivot_longer()` to transform the dataset from the wide format to a long format and name the columns as "activity_id" and "counts"
```{r}
activity = read.csv("data/accel_data.csv") %>% 
  janitor::clean_names() %>% 
  mutate(
    type = ifelse(day == c("Saturday", "Sunday"), "weekend", "weekday")
  ) %>% 
  pivot_longer(
    activity_1:activity_1440,
    names_to = "minute",
    names_prefix = "activity_",
    values_to = "counts"
  )
```

The dataset `activity` contains `r nrow(activity)` observations and `r ncol(activity)` variables. The variables are week, day_id, day, type (indicating whether it is a weekday or weekend), minute, and activity counts. 

Use `knitr::kable()` to create a table showing the total activity for each day.
Also create a scatterplot to see whether there is a trend.
```{r}
activity %>% 
  group_by(day_id) %>% 
  summarize(sum_counts = sum(counts, na.rm = TRUE)) %>% 
  knitr::kable(digits = 2)

plot_total = activity %>% 
  group_by(day_id) %>% 
  summarize(sum_counts = sum(counts)) %>%
  ggplot(aes(x = day_id, y = sum_counts)) +
  geom_point() +
  geom_line() +
  labs(
    title = "The total activity over the day",
    x = "Day id",
    y = "Total activity counts",
    caption = "Data from the accel_data")

plot_total
```

By observing the table and the plot, it seems that there is no apparent trend between total activity and day_id. 


Make a single-panel plot that shows the 24-hour activity time courses for each day and use color to indicate day of the week.
Use `geom_line()` to show the overall trend and use `geom_smooth()` to indicate variations within each day of a week.
```{r}
plot_each_day = activity %>% 
  mutate(hour = as.numeric(minute) / 60) %>% 
  ggplot(aes(x = hour, y = counts, color = day)) +
  geom_line(alpha = 0.5) +
  geom_smooth(se = FALSE) +
  labs(
    title = "The 24-hour activity time courses for each day",
    x = "Hour",
    y = "Activity counts") +
  scale_x_continuous(breaks = c(0, 4, 8, 12, 16, 20, 24))

plot_each_day
```

Based on the overall graph, we can observe that the overall activity counts are low from 0 am to around 5 am. The activity counts start to increase from 5 am to 9 am and has a peak around 7 am. Then the activity counts stay high and constant from 10 am to around 11 pm. 
Based on the `geom_smooth()`, we can observe there are differences between each day of a week. There is a distinct peak at around 10 am for Sunday and there is a distinct peak at around 10 pm for Friday.  


